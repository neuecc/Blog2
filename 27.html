<!DOCTYPE html>
<html dir="ltr" lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2834006-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-2834006-1');
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Z51JP7Z8W"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4Z51JP7Z8W');
    </script>

    <meta charset="utf-8" />
    <title>neue cc</title>
    <link rel="shortcut icon" href="https://neue.cc/favicon.ico" />
    <link rel="alternate" type="application/rss+xml" href="https://neue.cc/feed"/>
	<link rel="stylesheet" href="https://neue.cc/style.css" type="text/css" media="screen" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    
 </head>
<body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js"></script>
    <div id="wrapper">
        <a href="https://neue.cc/"><div id="header"></div></a>
        <link href="./pagefind/pagefind-ui.css" rel="stylesheet">
        <script src="./pagefind/pagefind-ui.js"></script>
        <div id="search"></div>
        <script>
            window.addEventListener('DOMContentLoaded', (event) => {
                new PagefindUI({ 
                    element: "#search", 
                    pageSize: 10,
                    highlightParam: "",
                    excerptLength: 10,
                    showImages: false,
                    showSubResults: false,
                    sort: { date: "desc" },
                    translations   : {
                        placeholder  : '',
                        clear_search : 'Clear',
                        load_more    : 'More',
                    }
                })
            });
        </script>
        <style>
            :root {
                --pagefind-ui-scale: 0.8;
                --pagefind-ui-primary: #9ba29f;
                --pagefind-ui-text: #9ba29f;
                --pagefind-ui-background: black;
                --pagefind-ui-border: #4d514f;
                --pagefind-ui-tag: #181818;
                --pagefind-ui-border-width: 0.5px;
                --pagefind-ui-border-radius: 0px;
                --pagefind-ui-image-border-radius: 8px;
                --pagefind-ui-image-box-ratio: 3 / 2;
                --pagefind-ui-font: 'Lucida Sans Unicode','Lucida Grande','Verdana','MS UI Gothic','sans-serif';
            }
            mark {
                background-color: blue;
                font-size: 99px;
            }
        </style>
        <div id="content"><h1 data-pagefind-sort="date:2009-07-10" data-pagefind-meta="published:2009-07-10"><a href="https://neue.cc/2009/07/10_174.html">ver 1.3.0.1(XboxInfoTwit) / exception(アーケード)</a></h1>
<ul class="date"><li>2009-07-10</li></ul>
<div class="entry_body"><ul>
<li><a href="http://neue.cc/software/xboxinfotwit">neue cc - XboxInfoTwit</a></li>
</ul>
<p>全てのゲームタイトルで、オンラインマッチ時にステータスが途中参加可能な状態で実績取得が出来ず、タイトル名がおかしくなる件を修正しました。Xbox.comから文字列決めうちで切り出しているので、どんな文言が来るのかのパターンに漏れがありましたというか知らんかった……。(ちなみに現在、待機中でも同様の問題があったりするので、直します、次回に、他にもないかちゃんと調べてから)。こうしてバグ発覚な上に(しかもこの問題は以前からあったっぽいです、全然気づいてなかった)、自信満々に互換性向上！とか言っておきながら、動かなかったって人がいるみたいでごめんなさい。しかも以前のバージョンでは動いていたとなると、もう本当にごめんなさい……。</p>
<p>//</p>
<p>ところで話かわって、<a href="http://i-saint.skr.jp/exception/">exception</a>のアーケード版が<a href="http://d.hatena.ne.jp/i-saint/20090709#1247108032">ロケテされてる</a>らしい、新宿南口ワールドで7/9～15だそうだ。というわけで行ってきましたは二日目。実は初日にも行ったんですが、お上りさんなので間違えて東口のタイトーステーションに行って、置いてないなあ、と思ってた。いや、「タイトーステーション 新宿南口ゲームワールド店」自体には何度か行ったことはあるんですよ！でも、タイトーって印象がないというか真面目にセガだと思ってた(笑) 別に西口のセガのと思い違いしてたわけでもなく素で。それで、東口のほうにはインベーダー(=タイトー)の印象があったので、ほぅほぅ、あんなところも南口に含めるのか、とか思ってたとか思ってたとか。悲しい。ゲーセンの店名って意識したことないのよね、あまり行かない人なので。</p>
<p>アーケード版のゲーム内容ですが、普通にexceptionでした。ステージは若干アレンジされていたり、オリジナルステージがあったりなどですが、内容は全くそのままPC版のexception。処理落ちなどもなく、ヌルヌルと動いておりました。ただし破片量はノーマルか、それより少ないか、といった感じで若干の寂しさは否めない。</p>
<p>気になる操作方法はジョイスティックとボタン3つ。全方位STGでスティック一本ということで、ボタン一つが方向
転換用の固定ボタン(PC版のディレクション)に割り当てられていて、これがぶっちゃけ操作しづらい。残りのボタンはレーザーとレイ、二つを(一度離して)同時押しでカタパルト。このカタパルト動作が筋力貧弱な私には存外辛くて、終わり頃には腕が疲れちゃってた。カタパルト→カタパルト→カタパルトと連打するわけなので、ワンボタンで出したいなあ、と思いつつも、まあボタンあまってないししょうがないね。</p>
<p>そんなこんなだから、というわけじゃないのですが、あえなくPC版3面ボス(アーケードでは5面、だったかな？)で死亡してスコアは5位でした。ランキング一位は、PC版作者のi-saint氏のよう。i-saint氏が初見で？クリアしたようなので、なら私も！とか意気込んでいたのですがズタボロ。いてれーたんに普通にいいように弄ばれるという微笑ましさを見せつけました。</p>
<p>ステージ構成はPC 版-&gt;アーケードオリジナル-&gt;PC版……と交互のようです。PC版は若干短く簡素にアレンジ。アーケードオリジナルのほうは破片の少なさを補うためにギミック中心の構造になっていて新鮮で面白い。ボスも同様に飛び道具系、というか変形する。アーケードオリジナルボス2体目の倒し方が分からなかくてライフが半分減るまで無意味なことやってたり。新鮮なのはよいことです。</p>
<p>全体的には、昔のアーケード→ファミコン移植のような印象。おお、頑張ってる！という。破片量はしょうがないとしても、操作し辛いのはどうしたものかなー。今回私は3ボタン使う上級者向け操作を選んだので、2ボタン操作の初心者向け操作だと印象違うかもしれません。そういえば、エフェクトも弱めなのでカタパルトの爽快感が薄かったような気がする。回りを破片で囲まれてピンチをカタパルトで一気に突破！的なのが、画面が真っ白になって抜け出せたのか何なのかわけわからないというか自機が本当に白に埋まって見失う、のはどうなのだろう、慣れかな？ジオメトリとかも見失うって言われるわけだし。</p>
<p>とはいえ普通にexceptionだったので普通に面白いと思います。オリジナル面も良い感じだし。PC版に比べてどうよ？と言われると完全にノーコメント(すみません)ですけど、ジョイスティックでやるのも新鮮、ということで遊びに行ける人は遊びに行くと良いやも。とりあえず私は途中で死亡したのが悔しいので、明日も行きます、というかロケテ中にはクリアしたい。(それにしても音楽も効果音も全く聞こえなかった、周囲の音うるさすぎ、私はひなびた田舎のゲーセンが好きですよ(笑))</p>
<p>あと、せっかくなので明後日、7/12の日曜日の22:00頃から<a href="http://www.ustream.tv/channel/neuecc">Ustream</a>でexceptionとexception conflictを実況プレイしようと思うので良ければ見てやってください。</p>
</div>
<h1 data-pagefind-sort="date:2009-07-08" data-pagefind-meta="published:2009-07-08"><a href="https://neue.cc/2009/07/08_173.html">ver 1.3.0.0 ロジック変更/OAuth対応</a></h1>
<ul class="date"><li>2009-07-08</li></ul>
<div class="entry_body"><ul>
<li><a href="http://neue.cc/software/xboxinfotwit">neue cc - XboxInfoTwit</a></li>
</ul>
<p>公開から半年以上経って、何故かここ数週間で利用者が増えてきたようで同時に動かない報告も目にするようになって嬉しくも悲しい。なので、今回ロジック部分を完全に書き換えました。これで色々な環境でも動作するようになった、はず、です。以前に試して動かなかったという方は、再度試していただけると嬉しいです。ついでに取得処理も軽量化しました。真面目に10倍ぐらいは速くなってます(今までが酷過ぎただけなんだけどね！)。そんなこんなで手を入れた部分が多いので、(ただでさえ不安定との定評があったのに)安定性はむしろ下がった、かも……。</p>
<p>それと、認証がパスワード方式からOAuth方式に変更になりました。ユーザーにとってOAuth対応によるメリットは、クライアントアプリではぶっちゃけ別にないどころかむしろ色々な不都合のほうが多いのですが私がやりたかった、ということで勘弁してください。投稿にfrom XboxInfoTwitってクライアント名が表示されるようになって嬉しいのです、にひひ。自動アップデート経由の方は、認証を一度済ませなければならないので手間です、すみません。</p>
<p>あ、で、ver1.2からそうなのですが、現在はAPIは一切利用していませんので遅延はありません。Xbox.comのステータス反映速度(1分以下で追随しているようです)で処理していますので、原理的には他の同種のアプリと同じです。が、多機能風味なため、巡回ページ数が多いのでチンタラ通信してたりする時があって、そのせいで反映が遅いという印象を持たれるかもしれません。今回の軽量化で若干印象は変わると思いますがそんなに変わらないかもしれません。その他、投稿の法則やFAQは同梱の説明書きを見てください。</p>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/xboxinfotwit_process.jpg">
</p>
<p>↑通信内容はこんな感じです(<a href="http://www.fiddler2.com/fiddler2/">Fiddler</a>で観測)。30秒かかりました。結構長いけれど、Xbox.comが重いサイトだからねえ……。まずフレンドリストの取得、そこからフレンドのフレンドに飛んで自分のステータスを取得(取得できない場合は取得出来るまで次のフレンドに飛ぶ)、トップページに飛んでプレイ中ゲームのURLを取得、プレイ中ゲームのページから実績を取得。という流れです。これがステータス取得の最短パスじゃないかと思っています。自分のステータスがFriendsOfFriend経由でしか見れないというのが意味不明で困るところ。</p>
<p>そういえばでどうでもいいんですが、タスクバー右クリックに「ゲイツポイントを買う」が追加されてます。アフィです、アフィ。んーと、ノーコメント。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-25" data-pagefind-meta="published:2009-06-25"><a href="https://neue.cc/2009/06/25_172.html">Linqで文字のバイト単位でグループ分け</a></h1>
<ul class="date"><li>2009-06-25</li></ul>
<div class="entry_body"><pre data-pagefind-ignore="all"><code class="language-csharp">var input = &quot;e4bba5e4b88be381aee69687e5ad97e58897e381af5554462d38e38292e69687e5ad97e382a8e383b3e382b3e383bce38387e382a3e383b3e382b0e5bda2e5bc8fe381a8e38199e3828b3136e980b2e695b0e381aee38390e382a4e38388e58897e381a7e38182e3828be38082&quot;;
var count = 0; // 外部にカウント用フラグ変数を置く
var words = Regex.Matches(input, &quot;..&quot;)
    .Cast&lt;Match&gt;()
    .Select(m =&gt; Convert.ToByte(m.Value, 16))
    .Select(b =&gt; Convert.ToString(b, 2).PadLeft(8, '0'))
    .ToLookup(s =&gt; (s.StartsWith(&quot;10&quot;)) ? count : ++count);
Console.WriteLine(words.Count);
</code></pre>
<p><a href="http://neue.cc/2009/06/25_171.html">前回</a>(たった10時間前ですが)の続き。16進数バイト列で表現されたUTF-8の文章の文字数を数えろ、というお話でした。せっかくなのでビット見てうんたらかんたら、のほうでも。律義に2進数に変換しながら分類。例えばwords[0]は[11100100,10111011,10100101]になる。こんな感じで41個分グルーピングされています。.Keyで何文字目かが取得出来るところが地味に素敵でいて微妙に混乱を招く(配列の何番目、ではない)。 で、まあしかし、場外にフラグ変数を置くことで何でもこなせるけれど、それってアリなの？という疑問はある。Linq連鎖の場外に変数を置くなんてグローバル変数的な害悪です。かどうかは分からないけれど、イマイチだとは思う。</p>
<p>場外に置かないで分類するとしたら、どうすればよいかなー。うーん。思い浮かばない。</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">var text = words.Select(g =&gt; g.Select(s =&gt; Convert.ToByte(s, 2)).ToArray())
    .Select(bytes =&gt; Encoding.UTF8.GetString(bytes))
    .Aggregate(new StringBuilder(), (sb, s) =&gt; sb.Append(s))
    .ToString();
Console.WriteLine(text);
</code></pre>
<p>こっちはどうでもいいんですが、文章への復元はこんな感じで。面倒くさー。何個Select使えば気が済むんだ、みたいなみたいな。でもLinq使わないとそれこそもっと面倒くさい気はする。とりあえず=&gt;かわいい。=&gt;のかわいさは異常。=&gt;がかわいいすぎて萌え死ぬ。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-25" data-pagefind-meta="published:2009-06-25"><a href="https://neue.cc/2009/06/25_171.html">Cast</a></h1>
<ul class="date"><li>2009-06-25</li></ul>
<div class="entry_body"><p><a href="http://www.klab.jp/tenka1programer/bosyu.html">天下一プログラマーコンテスト</a>、ほうほう、例題とな？</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">var input = &quot;e4bba5e4b88be381aee69687e5ad97e58897e381af5554462d38e38292e69687e5ad97e382a8e383b3e382b3e383bce38387e382a3e383b3e382b0e5bda2e5bc8fe381a8e38199e3828b3136e980b2e695b0e381aee38390e382a4e38388e58897e381a7e38182e3828be38082&quot;;
var bytes = Regex.Matches(input, &quot;..&quot;).Cast&lt;Match&gt;().Select(m =&gt; Convert.ToByte(m.Value, 16)).ToArray();
var result = Encoding.UTF8.GetString(bytes);
Console.WriteLine(result); // 以下の文字列はUTF-8を文字エンコーディング形式とする16進数のバイト列である。
Console.WriteLine(result.Length); // 41
</code></pre>
<p>題意に全然沿わずフレームワーク丸投げ。それにしても、古いクラス(MatchCollectionとか)はIEnumerable&lt;T&gt;じゃないのでCast&lt;T&gt;が必要で面倒くさい。Castは、その段階で「型を意識」しなければならないのが思考の流れを阻害する。「Select(m=&gt;m.」と打つと、ああ、送られてくるのはMatchなのかあ、って分かる。それ以上には考えさせないで欲しい。型推論万歳。型推論は、JavaScriptを始めとしたゆるふわ加減の心地良さと、型キッチリでコンパイルしてエラーが出て弾かれて万歳の気持ちよさがちょうどよく混ざり合ってて、イイなーって思う。だからというわけじゃないけど、なんでもvarで済ませてます、私は。var hoge = 3とか平気で書く。</p>
<p>そういえば、<a href="http://d.hatena.ne.jp/NyaRuRu/20080115/p1">Achiral</a>はMatchとMatchCollectionに、Selectのみ拡張メソッドで足してあるので、Castを書く必要なくスムーズに繋げられる。この面倒なMatchCollectionをどうしたものか、という解答として丁度良い妥協バランスで、なるほどなるほどでした。Achiralは読んでて本当にためになります。</p>
<p>追記：続き→<a href="http://neue.cc/2009/06/25_172.html">neue cc - Linqで文字のバイト単位でグループ分け</a></p>
</div>
<h1 data-pagefind-sort="date:2009-06-24" data-pagefind-meta="published:2009-06-24"><a href="https://neue.cc/2009/06/24_170.html">IEnumerableに文字列連結</a></h1>
<ul class="date"><li>2009-06-24</li></ul>
<div class="entry_body"><p><a href="http://csharper.blog57.fc2.com/blog-entry-267.html">C#と諸々 10分でコーディング</a>から。ネタ元、のネタ元の問題文の解読しづらさは異常。例も酷かった。というのはともかく、Linqならグルーピングのお話だよねー</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">class Cards
{
    public string[] Deal(int numPlayers, string deck)
    {
        var count = deck.Length / numPlayers;

        var result = deck
            .Select((c, i) =&gt; new { c, i })
            .GroupBy(t =&gt; (t.i % numPlayers), t =&gt; t.c)
            .Select(g =&gt; new String(g.Select(c =&gt; c).ToArray()))
            .Select(s =&gt; (s.Length &gt; count) ? s.Substring(0, count) : s)
            .ToArray();

        return (result.Length &lt; numPlayers)
            ? Enumerable.Repeat(&quot;&quot;, numPlayers).ToArray()
            : result;
    }
}
</code></pre>
<p>あれ、スッキリどころか意外と汚い……。んー、最初はGroupByのところがToLookupでそのままreturnしてすっきり終了。だったのですが、「求められるのはIGroupingじゃなくて文字列」なのでLookupじゃなくGroupByにして後段のSelectで結果を文字列化。「余ったカードは配られず捨てられる」ので更に後段のSelectで廃棄処分。「カードが足りなかった場合は人数分の空文字列配列を返す」のでreturnを別に分けてRepeatでそれを生成。後付けでごにゃごにゃ足していった結果、汚くなってしまった、残念。</p>
<p>まあでも、何が嫌かってnew Stringの部分ですね。中身がcharじゃなくて文字列の時はstring.Joinを使いますが、どちらもToArrayがウザくなってイヤー。IEnumerableにToStringは文字列で連結して欲しい。いや、Aggregateで代替出来るのは知ってますが定型処理のくせに必要なタイプ数多くてnew Stringとあんま変わらないし、セパレータも付けたいとなるといよいよ面倒くさい。というわけで拡張メソッドの出番。</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">public static class Ext
{
    public static string ToJoinedString&lt;T&gt;(this IEnumerable&lt;T&gt; source)
    {
        return source.ToJoinedString(&quot;&quot;);
    }

    public static string ToJoinedString&lt;T&gt;(this IEnumerable&lt;T&gt; source, string separator)
    {
        var index = 0;
        return source.Aggregate(new StringBuilder(),
                (sb, o) =&gt; (index++ == 0) ? sb.Append(o) : sb.AppendFormat(&quot;{0}{1}&quot;, separator, o))
            .ToString();
    }
}
</code></pre>
<p>残念ながら拡張メソッドは元からあるメソッド名を上書きできないのでToStringではなくToJoinedString。関数名が微妙？ そうですね……。 セパレータを使いたい場合にAggregateでサクッと書けなくて昔悩んだのですが、カウント用の変数を場外に用意すればいいんだ！と気付いたのでサクッと書けるようになりました。Linqだけで1行で済ませたい場合はSelectでindex作ってやればいいですねー。</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">var result = Enumerable.Repeat(&quot;hoge&quot;, 10)
    .Select((s, i) =&gt; new { s, i })
    .Aggregate(new StringBuilder(), (sb, t) =&gt; (t.i == 0)
        ? sb.Append(t.s)
        : sb.AppendFormat(&quot;{0}{1}&quot;, &quot;|&quot;, t.s));
</code></pre>
<p>悪夢だ。実行効率的にもアレゲ。いくらAggregateで何でも出来るといっても、この辺は標準搭載して欲しいものですねー、Sumがあるなら文字列連結があってくれてもいいじゃない、みたいな。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-20" data-pagefind-meta="published:2009-06-20"><a href="https://neue.cc/2009/06/20_168.html">AutoHotKeyでウィンドウのタイル配置</a></h1>
<ul class="date"><li>2009-06-20</li></ul>
<div class="entry_body"><p>以前にも<a href="http://neue.cc/2008/10/27_110.html">AutoHotKeyカスタマイズネタ</a>を書きましたが、私はウィンドウ移動系を多用しています。トリプルモニタの間を瞬時にジャンプさせたり、サイズをフィットさせたり。Windows7からWindowsボタン + ←でディスプレイの左半分にリサイズとかがあるので、幾分か被ってしまっているところもありますが、細かい部分では自分で調整したもののほうが、やはり使いやすいです。今回はその中から一つ、同一アプリケーションのウィンドウを水平に並べる関数を紹介します。水平に並べるって、昔懐かしMDIアプリにはありましたが、タブ全盛の昨今だと結構忘れ去られ……。</p>
<p>OSをWindows7に変更したところ、便利な<a href="http://qttabbar-ja.wikidot.com/">QTTabBar</a>が動かない。困ったねえ。ファイラー使えば？って話なのですが、エクスプローラーに統合されてる便利さは何にも代え難いものがある。と、いうわけで、なんかもうファイラーに戻る気しないしエクスプローラーのままでいいよぅ。でも、せめて多用するファイル移動をスムーズに行いたい→ウィンドウ複数毎開いたた時にズらすのが面倒くさい→こんなの全自動で並べるべき、人力で毎回やるなんてアホ→AutoHotKeyでスクリプト書きましょう。</p>
<pre data-pagefind-ignore="all"><code class="language-ini">;アクティブなアプリケーションと同一種類のウィンドウを水平垂直に並べる(最大4枚まで)
;アクティブウィンドウの左上座標が含まれるモニターに並べる
TileMove()
{
    WinGet, activeWindowID, ID, A
    WinGetPos, x, y, w, h, ahk_id %activeWindowID%
    SysGet, monitorCount, MonitorCount
    Loop, %monitorCount%
    {
        SysGet, m, MonitorWorkArea, %a_index%
        if (mLeft &lt;= x &amp;&amp; x &lt;= mRight &amp;&amp; mTop &lt;= y &amp;&amp; y &lt;= mBottom)
        {
            WinGetClass, activeWindowClass, ahk_id %activeWindowID%
            WinGet, id, list, ahk_class %activeWindowClass%
            Loop, %id%
            {
                w := (mRight - mLeft) / 2
                h := (id &gt; 2) ? (mBottom - mTop) / 2 : mBottom - mTop
                x := (Mod(a_index, 2) == 1) ? mLeft : mLeft + w
                y := (a_index &lt;= 2) ? mTop : mTop + h

                StringTrimRight, this_id, id%a_index%, 0
                WinActivate, ahk_id %this_id%
                WinWaitActive, ahk_id %this_id%
                WinMove, ahk_id %this_id%,,%x%, %y%, %w%, %h%
            }
            break
        }
    }
}
</code></pre>
<p>AutoHotKeyは三項演算子ないのかよ、クソ！とか思ってたのですが実は普通にあったことが判明。知らんかった。今回ようやく気付いた。で、これは関数の形にしているので、設定ファイルの上のほうにでも張り付けてやって、割り当ては好きなキーを選んでください。私は無変換＋Tabに振っています。その場合は「vk1Dsc07B &amp; Tab::TileMove()」になります。</p>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/autohotkeytilewindow.jpg">
</p>
<p>実行するとこんな風に整列します。二枚の場合は縦領域を全部使って平行並べになる。ワンタッチでサクッと出来て、かなり便利だと思います。あ、そういえば全然関係ないのですが、Win7からフォルダの新規作成にCtrl + Shift + nというショートカットキーが振られています。これは嬉しい。今まではQTTabBarのプラグインCreateNewItemButtonを使ってCtrl+Kを振っていたのですが、これでQTTabBarがなくてもやっていけるようになった、かどうかはまだまだ微妙だけど、何とか我慢できる。</p>
<p>つまるところ、Win7はかなりイイ。タスクバー回りも大きく変更が加えられていて、最初は慣れなくて以前の方式に戻そうかと思ったのですが、慣れてくると良く出来てるなーと感心しました。いやー、発売日には憧れの(？)秋葉で並ぶ、をやりたいぐらいに良いですねえ。ドライバも、インストール時に跳ねられるものもVista互換モードで動かすと大抵入るので発売日から入れようと、RCから入れようと、不安なところはない。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-18" data-pagefind-meta="published:2009-06-18"><a href="https://neue.cc/2009/06/18_167.html">XboxInfoTwit ver 1.2.0.0 フルスクレイピングに変更</a></h1>
<ul class="date"><li>2009-06-18</li></ul>
<div class="entry_body"><ul>
<li><a href="http://neue.cc/software/xboxinfotwit">neue cc - XboxInfoTwit</a></li>
</ul>
<p>Xbox.comのサイトがリニューアルされましたね！フレンドのフレンド表示機能のお陰で、ついに念願かなって自分自身のステータス取得に成功。野良APIを使わずに全てスクレイピングで実装することができました。よって、今回からは100%取りこぼしなく、ステータスの変更も瞬時に反映されます。他に変更点としては日付が投稿時の時間になりました(Xbox.com上からは時間を取れるものがないので) あと、書式に実績の数を追加しました。&quot;%TitleTotalAchievementCount%:タイトルの最大実績数&quot;, &quot;%TitleAchievementCount%:取得した実績数&quot; です。この変のよくわからないうえに長ったらしい名前はとても後悔しています……。</p>
<p>バグがあったら教えてください。どう見てもテスト不足なのでサクッと落ちるかもしれません。(言ってるそばから不具合発見しました。おまけに、zipファイルに格納するファイルが足りなかったので新規にダウンロードした場合は動かなかったっぽい。酷すぎる。というわけでver 1.2.0.1になりました。)</p>
</div>
<h1 data-pagefind-sort="date:2009-06-15" data-pagefind-meta="published:2009-06-15"><a href="https://neue.cc/2009/06/15_166.html">linq.js ver 1.3.0.2 - CascadeDepthFirst/BreadthFirst</a></h1>
<ul class="date"><li>2009-06-15</li></ul>
<div class="entry_body"><ul>
<li><a href="http://linqjs.codeplex.com/">linq.js - LINQ for JavaScript Library - Home</a></li>
</ul>
<p>linq.jsにCascadeDepthFirst, CascadeBreadthFirstを追加しました。ちょっと分かり辛いのですが非常に強力です。深さ優先/幅優先で多段SelectManyをかけていくようなイメージ。説明しづらいので例をどうぞ。</p>
<pre data-pagefind-ignore="all"><code class="language-xml">&lt;div id=&quot;tree&quot;&gt;Root
    &lt;div&gt;Spine
        &lt;div&gt;Neck
            &lt;div&gt;Head&lt;/div&gt;&lt;/div&gt;
        &lt;div&gt;RClavicle
            &lt;div&gt;RUpperArm
                &lt;div&gt;RLowerArm
                    &lt;div&gt;RHand&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
        &lt;div&gt;LClavicle
            &lt;div&gt;LUpperArm
                &lt;div&gt;LLowerArm
                    &lt;div&gt;Hand&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
    &lt;div&gt;RHip
        &lt;div&gt;RUpperLeg
            &lt;div&gt;RLowerLeg
                &lt;div&gt;RFoot&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
    &lt;div&gt;LHip
        &lt;div&gt;LUpperLeg
            &lt;div&gt;LLowerLeg
                &lt;div&gt;LFoot&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
</code></pre>
<p>こんなHTML、というかツリーに色々と操作することにします。例えばinnerTextのように、深さ不明のchildNodesを全て掘ってTextNodeだけを取り出して値を連結するとしたら、通常は再帰を使いますよね。でも、CascadeDepthFirstを使えば</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var root = document.getElementById(&quot;tree&quot;);
var innerText = E.Make(root)
    .CascadeDepthFirst(&quot;$.childNodes&quot;)
    .Where(&quot;$.nodeType == 3&quot;)
    .Select(&quot;$.nodeValue&quot;)
    .ToString();
</code></pre>
<p>こんな感じに書けます。rootから深さ優先探索で子ノードを全取得、そのうちnodeTypeが3のもの(TextNode)のnodeValueを文字列連結。宣言的に、再帰よりも分かりやすく書けます。何より後段で豊富なLinqメソッドを使って値を操作していけるのが利点になります。今回から新しく追加されたMake(hoge)というのはRepeat(hoge,1)と等しい。Fromを用いるとオブジェクトはKeyValuePairに、文字列は一文字ずつのシーケンスに化けてしまうので、今回からこのメソッドを用意しました。</p>
<p>実のところMakeもCascadeDepthFirstも<a href="http://d.hatena.ne.jp/NyaRuRu/20080115/p1">C# 3.0 Supplemental Library: Achiral - NyaRuRuの日記</a>のパクりです(AchiralではMakeはMake.Sequence)。ぶっちゃけ今までも勝手に散々パクッているので(ごめんなさい、ありがとうございます。ライセンス的にアレっぽいので、どこかに書いておかないと……) むしろ何で今更追加なのかというと、あまりにも露骨すぎて劣化コピーを入れるのは失礼に思っていて。結局入れてしまったけれど。そんなわけで応用的なものを一つ。引き続き↑のDOMツリーを使って……</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var root = document.getElementById(&quot;tree&quot;);
E.From(root.childNodes)
    .Select(function(child) { return { child: child, parent: root} }) // 外部の値を取りこむ時は文字列ラムダ式は使えません
    .CascadeDepthFirst(function(pair) // 中を入れ子で親の値を参照したいので文字列ラムダ式は不可
    {
        return E.From(pair.child.childNodes)
            .Select(function(child) { return { child: child, parent: pair.child} });
    }, &quot;v,n=&gt;{value:v,nestLevel:n}&quot;) // CascadeDepth/BreadthFirstの第二引数はネストレベルを利用可能
    .Where(&quot;$.value.child.nodeType == 1&quot;) // ELEMENT_NODEだけを取得するためフィルタ
    .WriteLine(function(t)
    {
        return t.nestLevel + ':'
            + E.From(t.value.child.childNodes).First().nodeValue + ' . '
            + E.From(t.value.parent.childNodes).First().nodeValue;
    });
</code></pre>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/cascadedepthfirst.jpg">
</p>
<p>例もパクりです。<a href="http://d.hatena.ne.jp/NyaRuRu/20080604/p1">与えられた木から，子→親への対応を作る，を C# で - NyaRuRuの日記</a>を、HTMLだったらツリーはDOMだよね、という感じで書いてみました。第二引数にはネストレベルを取得できるリザルトセレクターが使えます(省略も当然可能)。んー、DOMだとTextNodeが混ざるせいで、例として不適切に処理が混沌としてしまいました。あ、WriteLineの部分は子要素のFirstがTextNodeであると決め打ちしてます。正確にやりたいなら冒頭のinnerTextの例のようにWhereでTextNodeのみに絞った上で、ToStringで連結したほうが良いですね。</p>
<p>CascadeDepthFirstをCascadeBreadthFirstに変えると(両者は探索方式が違うだけで引数や戻り値は一緒)、こんな結果になります。</p>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/cascadebreadthfirst.jpg">
</p>
<p>動作の差異がよく分かるんじゃないかなーと思います。</p>
<h2>continue/break</h2>
<p>ForEachでcontinue/breakを使えるようにしました。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">E.Range(1, 100).ForEach(function(i)
{
    if (i % 2 == 0) return true; // continue
    if (i == 7) return false;    // break
    alert(i); // 1,3,5
});
</code></pre>
<p>灯台下暗しというか、こういうのって自分が必要になるまで気付かないというか。Linqって基本的に前段階のWhereで絞るからこの辺のものって必要になる機会が少ないんですよね。いや、言い訳ですけど。で、まあ、jQueryと同じでtrueをreturnすればcontinue、falseをreturnすればbreakになります。実装は超単純。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">while (enumerator.MoveNext())
{
    if (action(enumerator.Current, index++) === false) break;
}
</code></pre>
<p>ActionなのにFuncになってしまった！しまった！と、思わなくもないけど、この辺が後付けでグダグダになるのはしょうがないので気にしないことにしよふ。じゃなくて、基本はActionなのでヨシとしておこう。むしろこの辺はJavaScriptがユルフワなのでC#ルールに(用語を)当てはめようとして無理が出ているだけ。そういえばで、個人的にはreturn;でcontinue、return true;でbreakにしたいなあ、とか思ったり思わなかったりなのだけど、その辺は標準に合わせた方が混乱しなくていいよねー、と思うことにしました。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-10" data-pagefind-meta="published:2009-06-10"><a href="https://neue.cc/2009/06/10_165.html">Suggest(モドき)</a></h1>
<ul class="date"><li>2009-06-10</li></ul>
<div class="entry_body"><p>どうも、新PC組んだりして(Core i7だしメモリ12GだしIntelのSSD2枚刺しでこれで数年は買い換えないでも前線で闘っていける！と思いたいのだけど、そこら中で微妙にコスト削減で若干残念になっていたり、ExtremeじゃなくてMainstreamなところとか) まあ、それはそれ。で、Windows7 RC1を入れて若干の苦戦を強いられていて環境整えるのに時間かかりそう－、というわけでショボいネタを一つ。</p>
<input type="text" id="inputBox" style="display: block" />
<table cellspacing="0" cellpadding="0" id="linqsuggest" style="position: absolute; margin-top: 5px; border: solid 1px black; background: white; width: 300px;">
</table>
<script type="text/javascript">
    // これが補完候補、ただの文字列配列
    var list = ["tokyo", "kanagawa", "tochigi", "saitama", "sapporo", "nagano"];

    // イベントハンドラは引数を二つ取る、一つは送り元、もう一つはイベント
    X.ID("inputBox").AttachEvent("keyup", function(sender, event)
    {
        var suggestArea = X.ID("linqsuggest");
        suggestArea.RemoveNodes(); // 子ノード全削除
        if (event.keyCode == 13) // eventはイベント
        {
            sender.value = ""; // 空にするだけ……
            return;
        }
        var text = sender.value; // senderは送信元DOM要素、今回はTextBox

        // この4行が本編です、ええ
        suggestArea.Add(X.Elem("tbody",
            E.From(list)
                .Where(function(s) { return s.indexOf(text) != -1; })
                .Select(function(s) { return X.Elem("tr", X.Elem("td", s)) })
        ));
    });
</script>
<pre data-pagefind-ignore="all"><code class="language-javascript">// これが補完候補、ただの文字列配列
var list = [&quot;tokyo&quot;, &quot;kanagawa&quot;, &quot;tochigi&quot;, &quot;saitama&quot;, &quot;sapporo&quot;, &quot;nagano&quot;];

// イベントハンドラは引数を二つ取る、一つは送り元、もう一つはイベント
X.ID(&quot;inputBox&quot;).AttachEvent(&quot;keyup&quot;, function(sender, event)
{
    var suggestArea = X.ID(&quot;linqsuggest&quot;);
    suggestArea.RemoveNodes(); // 子ノード全削除
    if (event.keyCode == 13) // eventはイベント
    {
        sender.value = &quot;&quot;; // 空にするだけ……
        return;
    }
    var text = sender.value; // senderは送信元DOM要素、今回はTextBox

    // この4行が本編です、ええ
    suggestArea.Add(X.Elem(&quot;tbody&quot;,
        E.From(list)
            .Where(function(s) { return s.indexOf(text) != -1; })
            .Select(function(s) { return X.Elem(&quot;tr&quot;, X.Elem(&quot;td&quot;, s)) })
    ));
});
</code></pre>
<p>入力補完モドきです。見にくいですけど、ソースコードの上にある入力ボックスにgaでkanagawaとnaganoが表示される、とかそんな感じ。エンターキーによる入力には対応してません、ただたんに絞り込んで表示するだけのデモです。んーと、suggestArea.Addからの、たった4行でリストの絞り込みして-&gt;DOM作成が出来るね、簡単だね、素晴らしいね、関数型構築とLINQの合わせ技は強力ですよね、だからみんなも使ってね、ということが言いたいそうです。世の中、WhereしてSelectするだけで9割方カバー出来る。気がする。気のせい。</p>
<p>ちゃんと真面目に作っていきたい気もするのですが、この強引リニアサーチのまま拡張しても野暮ったいだけで意味ないなー、と思うので気が乗らない。でも、大量のデータを扱うわけじゃなければ、この程度の手抜き実装でも普通に何とかなるものですよねー、とは思わなくもない。無理に洗練されたものを作ろうとせず、領域を見極めて労力を最小限にしたいと私は思ふ。いや、手抜きじゃなくて。手抜きですけど。</p>
<p>今後のlinq.xml.jsは微妙に機能足りてないというか、クロスブラウザ回りがグダグダなのと(Attributeにstyle指定がIEだとコケるとか！) DOMと混ぜ合わせてると気になるところが幾らかあるので、ボチボチと作っていきます。素のlinq.jsには深さ優先探索/幅優先探索を入れようとしているのですが、PC入れ替え中なのでもうしばらく後。</p>
<p>一体誰にアピールしてるの？な寂しさを感じつつも、それを言ったら前回の記事なんてどこからどうみても露骨なまでに受け狙いに走ったわりには大不発で寒すぎたので、それを考えたらマシです、いや、よくわからないけれど。でも簡単アピールは何か違う気がする……。うーん。まあ、誰が使わなくても自分は使うわけなので適当に行きましょふ。</p>
</div>
<h1 data-pagefind-sort="date:2009-06-06" data-pagefind-meta="published:2009-06-06"><a href="https://neue.cc/2009/06/06_164.html">最もタメになる「初心者用言語」はVisualStudio(言語?)</a></h1>
<ul class="date"><li>2009-06-06</li></ul>
<div class="entry_body"><ul>
<li><a href="http://linqjs.codeplex.com/" title="linq.js - LINQ for JavaScript Library - Home">linq.js - LINQ for JavaScript Library - Home</a></li>
</ul>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/linqjsintellisense.jpg">
</p>
<p>本題、に入る前にlinq.jsの更新内容を。今回からVisualStudio上でJavaScriptを書く際にIntelliSense(コード補完)のサポートが効くようになりました。これでもうリファレンスと睨めっこしなくてもすみます。IntelliSenseが出てくれば使えて、出てこなければ使えない。引数の型までは補完してくれませんが、メソッドチェーンに関しては100%信頼出来ます。利用するにはVisualStudio2008 SP1と<a href="http://code.msdn.microsoft.com/KB958502/Release/ProjectReleases.aspx?ReleaseId=1736" title="KB958502 - JScript Editor support for “-vsdoc.js” IntelliSense doc. files - Release: KB958502">対応パッチ</a>をあてる必要があります。私はProfessionalで確認していますが、<a href="http://www.microsoft.com/japan/msdn/vstudio/Express/">Express Edition</a>でも行けると思います。</p>
<p>もう一つ、linq.xml.jsのほうは、今回からXML/DOMの関数型構築が可能になりました(関数型構築の詳細は<a href="http://neue.cc/2009/05/29_163.html" title="neue cc - DOMの関数型構築">前回記事</a>を参照ください)。それに伴い実例として、同梱してあるTwitterビューアサンプルも関数型構築に、ついでに@usernameにアンカーを張るように変更しました。</p>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/linqtoxmltodom.jpg">
</p>
<p>DOM構築時にLinqクエリを埋め込めると何が便利なの？のサンプル。全体像(obj.textって何だよ、とか)は同梱のものを見てください。obj.textは「@hoge hugahuga @foo hogehoge」な感じ(ようはTwitterの投稿の本文)で、文字列置換なら@usernameをa hrefで囲むだけだけど、DOMでやるにはどうしよう→全部マッチさせちゃえばいいぢゃない、それならSelectで射影すると楽ですね、という流れ。E.Matchesはキャプチャ付きの正規表現グローバルマッチが気楽に使えて非常に便利。</p>
<h2>VisualStudioの薦め</h2>
<p>以前に<a href="http://generation1986.g.hatena.ne.jp/ukstudio/20080204/1202113687">最もタメになる「初心者用言語」は</a>、という話題で盛り上がっていたけれど、その時JavaScriptを挙げた人の多くが開発環境を入れる必要なく、テキストエディタがあればそれだけで始められるから、といったものが多かったけど、正直どうかなー、と思っていました。1年以上前のネタに今頃乗っかるのって感じですが今頃乗っかてみます。</p>
<p>初心者は、使えるメソッドが分からないから一々リファレンスを引くのに手間取るし(私は今だって文字列のsubstrとsubstringで悩む、特にJavaScriptはこの手の罠が多いし)、しょうもないタイプミス(大文字小文字とか)に悩まされてプログラムが動かない。演算子やカッコにスペースを空ければいいのかどうかも悩むし、一々手で直すのは手間だけど直さなければ汚いし……。</p>
<p>言語の学習って、特に最初はとにかく書くこと、それが最も覚えやすいと思うのです。リファレンスを引く時間も、手動でスペースを空ける時間も、言語の学習とは全く関係ない余計な時間です。限りなくゼロに近づけた方が良い。リファレンスを引く時間がゼロならば、その分だけ書く作業に時間を回せます。だから、テキストエディタじゃなくIDEを使おう。入力補完は一々リファレンスを引く必要もなく使えるメソッドをリストアップしてくれるし、ヘルプを見る必要もなくメソッドの解説が書かれている。補完があるからタイプミスも起こらないし、「長くてもいいから良い名前を付ける」習慣もつく。インデントだのスペースだのカッコの段落だのは、全てドキュメントフォーマッタ(VSではCtrl+E,D)で機械に任せるのが、完璧で綺麗で、何より手間がかからない。</p>
<p>そんなことより前に、そもそもforで変数がどう移り変わっているのかもよくわからないし。デバッガ、あったほうがいいでしょう、絶対に。あるのとないのとでは学習速度の桁が違ってくる。<a href="http://gihyo.jp/dev/feature/01/firebug">Firebugがある</a>って？いや、Firebugは確認用には物凄く便利だけど、それの上で開発とか辛くない？私は無理でした。ついでに言えば、Firebugインストールする手間もVisualStudioをインストールする手間も一緒。</p>
<p><a href="http://www.microsoft.com/japan/msdn/vstudio/Express/" title="Microsoft Visual Studio 2008 Express Edition">Microsoft Visual Studio</a>はWebインストールを選べば何の手間もいらずダウンロードされ、そのままインストールに入り30分程度で終わる(ダイアログの「はい」を押して待つすだけです、Eclipseと違って何入れればいいか、プラグインがどうのこうの、で悩む必要なくそのものがAll in One)、VSの使い方を知るのに30分。周囲に使える人がいれば、勘所を聞くだけで済むので10分。別に何も最初から全てを知る必要はなく、ダミーのASP.NETプロジェクト作って、F9でブレークポイント設定してF5でデバッグ実行してウォッチウィンドウで変数を監視する。それだけ分かれば十二分です(そこを分かるまでが辛い、というのはあります、分かっている人が横にいれば1分で済む話なのに、こんな初歩的な情報はあまりネットに転がってないから分かりようがない。需要がありそうなら書きますが……)</p>
<h2>jQueryにも使える</h2>
<p>jQuery大人気！ やっぱjQueryが使えないとね！と、で、VisualStudioはjQueryに、jQueryオフィシャルが対応しています。どういうことか、というと<a href="http://docs.jquery.com/Downloading_jQuery">jQueryのダウンロードページ</a>を見てください。Release NoetsとMinifiedとUncompressedと、Documentation: Visual Studio。そう、この公式に配布されているｊquery-vsdoc.jsを使う(jquery.jsと同じディレクトリに置くだけです)と、VS上で丁寧に書かれた解説付きの入力補完が効くようになります。</p>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/jqueryintellisense.jpg">
</p>
<p>jQueryの特徴といったらメソッドチェーン。ドット打つとの候補が出てくる出てくる、という感覚はとても楽しい。その楽しさを更に加速させるのがIntelliSense。メソッド名何だっけ、引数は何を取るんだっけ、と悩むこともない。ドット打って選ぶだけ。処理の本質部分だけに集中できる。</p>
<p>そういえば<a href="http://gyauza.egoism.jp/clip/archives/2009/05/javascript-oop1/">オブジェクトっぽい話が分かるかもしれないJavaScript講座</a>が大人気ですけれど、便乗して言うとjQuery使うなら、まずVisual Studio、があれば、もうあとはドット打つだけなので何も考えないでもいいぐらい。んーと、本題はオブジェクトっぽい話、ですけれど、アレですね、何のかんのでオライリーのJavaScript 第5版を読むのが一番分かりやすかった。ケチッてWeb上のチュートリアルをブクマして読んで、なんてやるよりも、この場合は黙って金出して本読むのが時間の節約にも、得られる知識の濃さ的にもよろしいかと思われます。</p>
<iframe src="https://rcm-jp.amazon.co.jp/e/cm?t=ilsgeometrati-22&o=9&p=8&l=as1&asins=4891006188&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
<iframe src="https://rcm-jp.amazon.co.jp/e/cm?t=ilsgeometrati-22&o=9&p=8&l=as1&asins=4873113296&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
<p>amazonついでにLINQ本も張っておきます。LINQ本は以前に「<a href="http://www.amazon.co.jp/gp/product/4891006048?ie=UTF8&tag=ilsgeometrati-22&linkCode=as2&camp=247&creative=7399&creativeASIN=4891006048">LINQテクノロジ入門</a><img src="http://www.assoc-amazon.jp/e/ir?t=ilsgeometrati-22&l=as2&o=9&a=4891006048" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />」という薄い本が出ているのですが、ほとんどLinq to Sqlのことしか書いていないので、少し高いのですが本で学ぶのならこちらの、プログラミングLINQのほうが良いです。初級-中級的には<a href="http://www.amazon.co.jp/gp/product/1933988169?ie=UTF8&tag=ilsgeometrati-22&linkCode=as2&camp=247&creative=7399&creativeASIN=1933988169">Linq in Action</a><img src="http://www.assoc-amazon.jp/e/ir?t=ilsgeometrati-22&l=as2&o=9&a=1933988169" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />のほうがお薦めなのですが翻訳されてないしされる気配もなさそうですね、残念。そうそう、linq.jsも宜しくお願いします。
C#との高い互換性と、<a href="http://neue.cc/reference.htm" title="linq.js Reference">リファレンスにおいてあるLINQ Pad</a>はリアルタイムに動作を確認可能、なので学習用途ならかなりイイと思います。パフォーマンスは？実装がヘコい？是非とも突っ込みを！</p>
<h2>入力補完の嬉しさ</h2>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/vsintellisense.jpg">
</p>
<p>まんじゅうの例を借りると、prototypeにメソッド突っ込んでオブジェクトほにゃららで何が嬉しいのか、というと、入力補完が効く。使えるメソッドがドット打つだけで出てくるし手入力する必要ない。jQueryのようにヘルプは出てきませんが、補完はちゃんと効くのです。同様に何のメソッドがあるのかさっぱり分からないDOM要素に対しても動くし、紛らわしさ全開な文字列に対しても効きます、便利便利。こうして眺めてると、知らないメソッドがあったりして勉強にもなる。</p>
<p>ところで突然C#の話に移って同様に、ポリモーフィズムで何が嬉しいの→入力補完が効く。ジェネリクスの何が嬉しいの→入力補完が効く。動的言語じゃなくて静型な型付け言語(C#とかJavaとか)の何が嬉しいの？→入力補完が超完璧に効く。型推論の何が嬉しいの？→入力補完が超完璧に効く上に更に型を入力する手間も最小限に抑えられる。</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">// これをそれぞれ二乗する
int[] array = { 1, 2, 3, 4, 5, 6, 7, 8, 9 };
// C# 2.0ではこんなクソみたいなコードが
int[] c2 = Array.ConvertAll&lt;int, int&gt;(array, delegate(int i) { return i * i; });
// C# 3.0ではこんなに短く! Rubyっぽく見えませんか？
var c3 = array.Select(i =&gt; i * i);
</code></pre>
<p>C#2.0だと、本質的な記述部分(i x i)以外の量の方が死ぬほど多くなってしまい、これじゃ嫌われて然りであり動的言語に行きたくもなる。何個intを書かせるんだよボケ、intなんて自明なんだよクソがって感じです。けれど、C#3.0からの型推論＋ラムダ式があればとてもすっきりした上に、ちゃんと補完が効く(i x iを記述している最中もiがintであることを示してくれる)ので物凄く書きやすい。JavaScriptもいいけどC#も良いです。無名関数を愛するJavaScripterならC#のラムダ式はもっと愛せると思います(ウザいカッコとreturnが必要ないので)</p>
<p>C#は特にWindows用のデスクトップアプリケーションを作るなら、作りやすさで言えばベスト。.NET Frameworkは嫌だ？やっぱC++でしょって？うーん、ゲームを作るんでもないならC++の性能は必要ないし、作りやすさでいったらC#&gt;超えられない壁&gt;C++ですよ。C#は開発者に優しいゆるふわ言語。C++はF1マシン、とっても扱いにくいけど凄く速い。C#はプリウス。実用性と最先端ハイテクのバランスが絶妙。そもそも公道をF1カーで走ることが無茶苦茶なのです、公道はプリウスで十分どころか、むしろベストというもの。何にでも、適した領域というものがある。</p>
<iframe src="https://rcm-jp.amazon.co.jp/e/cm?t=ilsgeometrati-22&o=9&p=8&l=as1&asins=4873113962&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
<iframe src="https://rcm-jp.amazon.co.jp/e/cm?t=ilsgeometrati-22&o=9&p=8&l=as1&asins=4891006072&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
<p>しかも今C#を覚えると、もれなくSilverlightも付いてきます(Flashの開発言語がActionScriptであるように、Silverlightの主な開発言語はC#)。Flashに勝てるわけないだろヴァーカって？何にせよとりあえずツバだけでもつけておくと生きやすいかなーって思いません？Flash業界なんてレッドオーシャンもいいとこ、今から飛び込むならSilverlight。Microsoftは本気なのであっさりと消滅することはないでしょう。本気の時のMicrosoftはとってもしぶとくしつこい。</p>
<p>でもまあ、そんな云々はどうでもよくて、普通にLINQ楽しいですよ！が一番に言いたいことです。ええ、LINQ楽しい。LINQがあるからC#万歳だし、LINQがなくても作ったのでJavaScriptも万歳。linq.jsは初回リリース時に<a href="http://neue.cc/2009/04/04_145.html" title="neue cc - linq.js - JavaScript用LINQライブラリ">チュートリアルめいたもの</a>が書いてあるので、よければどうぞ、というかお願いしますお願いします。</p>
</div>
<h1 data-pagefind-sort="date:2009-05-29" data-pagefind-meta="published:2009-05-29"><a href="https://neue.cc/2009/05/29_163.html">DOMの関数型構築</a></h1>
<ul class="date"><li>2009-05-29</li></ul>
<div class="entry_body"><p>Linq to XMLのJavaScript移植、もポチポチと進めています。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var xml = new XElement(&quot;customer&quot;, new XAttribute(&quot;id&quot;, &quot;c001&quot;),
              new XElement(&quot;firstName&quot;, &quot;Paolo&quot;),
              new XElement(&quot;lastName&quot;, &quot;Pialorsi&quot;),
              new XElement(&quot;addresses&quot;,
                  new XElement(&quot;address&quot;, new XAttribute(&quot;type&quot;, &quot;email&quot;), &quot;paolo@devleap.it&quot;),
                  new XElement(&quot;address&quot;, new XAttribute(&quot;type&quot;, &quot;url&quot;), &quot;http://www.devleap.it/&quot;),
                  new XElement(&quot;address&quot;, new XAttribute(&quot;type&quot;, &quot;home&quot;), &quot;Brescia - Italy&quot;)
              )
          );

alert(xml.Source.outerHTML); // .Sourceは気にしないでください(最終的には隠蔽されるので)
</code></pre>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/linqtoxml1.jpg">
</p>
<p>これは何と、C#にコピペしても動く。つまり互換性100%(笑) 所謂マークアップビルダになります。私がC#っ子だから、というのもあるけれど、JSON風に書くより好き。JSON風だとそれぞれのライブラリが属性対応のため変則的な書き方ルールが用いられていて、それを覚えなきゃいけないけれど、これなら要素に属性と値を突っ込むだけなので学習コストがほとんどない。と、思う。IntelliSenseのサポートも効くし(現在linq.jsをIntelliSenseが効くよう整備中です、土日に書きすすめて公開、したいなあ)。そのかわりnewだらけでちょっと冗長に過ぎるところはあるかもしれない。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">// ユーザー名と発言と投稿を持ったクラス
var Twit = function(user, text)
{
    this.user = user;
    this.text = text;
}

// とりあえずサンプルデータ
var data1 = new Twit(&quot;ika&quot;, &quot;いかはいかが&quot;);
var data2 = new Twit(&quot;tako&quot;, &quot;たこやき&quot;);
var data3 = new Twit(&quot;sakana&quot;, &quot;丸焼き&quot;);

// XmlHttpほげほげだのJSONだのな結果の例として配列
var list = [data1, data2, data3];

// リストをSelectでXElementに射影すると自動的に展開される
var xml = new XElement(&quot;twitter&quot;,
              new XElement(&quot;account&quot;, &quot;neuecc&quot;),
              new XElement(&quot;twits&quot;, E.From(list).Select(function(t)
              {
                  return new XElement(&quot;twit&quot;, new XAttribute(&quot;user&quot;, t.user), t.text)
              }))
          );

alert(xml.Source.outerHTML); // .Sourceは気にしないでください(最終的には隠蔽されるので)
</code></pre>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/linqtoxml2.jpg">
</p>
<p>例をもう一つ。例が適当かつ分かり辛くてすみませんなのですが、Selectで射影しておくと、展開されます。何らかのオブジェクトを繰り返してDOMにする、というシーンは多いと思うのですが、forはもう必要ありません。むしろfor禁止。ループは悪。「この配列を」「この形に展開する」と宣言的に記述するだけで良いのです。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var table = new XElement(&quot;table&quot;,
                new XElement(&quot;tr&quot;,
                    new XElement(&quot;td&quot;, &quot;column1&quot;),
                    new XElement(&quot;td&quot;, &quot;column2&quot;),
                    new XElement(&quot;td&quot;, &quot;column3&quot;)
                ),
                E.Repeat(&quot;tr&quot;, 5).Select(function(tagName)
                {
                    return new XElement(tagName,
                        E.Range(1, 3).Select(function(i)
                        {
                            return new XElement(&quot;td&quot;,
                                new XAttribute(&quot;style&quot;, (i % 2 == 0) ? &quot;background:red&quot; : &quot;background:green&quot;),
                                &quot;row&quot; + i);
                        })
                    )
                })
            );

// FirefoxではouterHTML動きませんけど、最終的には隠蔽されるので（ｒｙ
document.body.innerHTML = table.Source.outerHTML;
</code></pre>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/linqtoxml3.jpg">
</p>
<p>簡単なTableの生成例。これrowになってませんね、あはは。まあ、いいや。関数の引数の中に式を書くという感覚が最初はキモかったのですが、今では平然と書くようになってしまいました。何というLinq中毒……。しかし、JavaScriptだとfunction(){return }のせいでゴチャゴチャして分かり難いものになってしまう。ラムダ式欲しいなあ。{とかreturnとかいらない。<a href="https://developer.mozilla.org/ja/New_in_JavaScript_1.8">Firefox3では省略出来る</a>けど、Chromeはまだ出来ないみたい……。</p>
<p>Firefox3は使えば使うほど嫌いになるという素敵ブラウザなので、本気でChromeに乗り換える気はありますよ！アドオンがなければ自分で作ればいいじゃない、と思うことにしますので、作りたいですね。一応Hello,Worldは書いた。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">&lt;script type=&quot;text/javascript&quot; src=&quot;linq.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;linq.xml.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    // Initialize
    X.Initialize(function()
    {
        X.ID(&quot;panel&quot;).AttachEvent(&quot;click&quot;, panel_onclick);
    });

    // EventHandler
    function panel_onclick(sender, event)
    {
        X.ID(&quot;titleLabel&quot;).SetValue(event.screenX);
    }
&lt;/script&gt;

&lt;div id=&quot;panel&quot; class=&quot;toolstrip-button&quot;&gt;
    &lt;span id=&quot;titleLabel&quot;&gt;Hello, World!&lt;/span&gt;
&lt;/div&gt;
</code></pre>
<p>ええ、ただのHTMLです。ステータスバーのところにHello,Worldが出てクリックできるという、それだけのもの。Chromeの拡張はまだ何が出来るか分からないというか何も出来ないというか、それグリモンでいいよね、的なことしか出来ない感じなので、その間、今のうちにlinq.xml.jsを完成させよう。何かもう意地でも自分は使う、な方向に傾いてる気がしますが。jQuery？何それ。</p>
</div>
<h1 data-pagefind-sort="date:2009-05-27" data-pagefind-meta="published:2009-05-27"><a href="https://neue.cc/2009/05/27_162.html">JavaScriptで総当たり</a></h1>
<ul class="date"><li>2009-05-27</li></ul>
<div class="entry_body"><ul>
<li><a href="http://d.hatena.ne.jp/NyaRuRu/20080303/p2" title="クエリ式で総当たり - NyaRuRuの日記">クエリ式で総当たり - NyaRuRuの日記</a></li>
<li><a href="http://d.hatena.ne.jp/ufcpp/20080304/1204633735">多重 from の展開結果 - ++C++; // 管理人の日記</a></li>
</ul>
<blockquote>
<p>Baker, Cooper, Fletcher, MillerとSmithは五階建てアパートの異なる階に住んでいる。Bakerは最上階に住むのではない。Cooperは最下階に住むのではない。Fletcherは最上階にも最下階にも住むのではない。MillerはCooperより上の階に住んでいる。SmithはFletcherの隣の階に住むのではない。FletcherはCooperの隣の階に住むのではない。それぞれはどの階に住んでいるか。</p>
</blockquote>
<pre data-pagefind-ignore="all"><code class="language-javascript">// 条件を並べて総当たり問題を解く
var apart = E.Range(1, 5);
var answers = apart
    .SelectMany(function(baker){ return apart
    .SelectMany(function(cooper){ return apart
    .SelectMany(function(fletcher){ return apart
    .SelectMany(function(miller){ return apart
    .Select(function(smith){ return {
        baker: baker, cooper: cooper, fletcher: fletcher, miller: miller, smith: smith}})})})})})
    .Where(&quot;E.From($).Distinct('$.Value').Count() == 5&quot;)
    .Where(&quot;$.baker != 5&quot;)
    .Where(&quot;$.cooper != 1&quot;)
    .Where(&quot;$.fletcher != 1 &amp;&amp; $.fletcher != 5&quot;)
    .Where(&quot;$.miller &gt; $.cooper&quot;)
    .Where(&quot;Math.abs($.smith - $.fletcher) != 1&quot;)
    .Where(&quot;Math.abs($.fletcher - $.cooper) != 1&quot;);
 
 // 動作確認、Templateのお陰で記述がとても楽
answers.ForEach(function(obj)
{
    var str = Linq.Tools.Template(&quot;baker : {baker},\
       cooper :{cooper},\
       fletcher :{fletcher},\
       miller : {miller},\
       smith : {smith}&quot;,
       obj);
    alert(str); // とりあえずalertで確認
});
</code></pre>
<p>メソッド構文の最大の敵、多重fromを何とかする。今回の場合はカッコを閉じず、最後にSelectを使えばクエリ構文に近い見た目が確保できる。大量の閉じ括弧と、大量のWhereに対してラムダ式が面倒くさくなるのだけはどうにもならないのだけれど。C#で一通り書いてから、JavaScript + <a href="http://linqjs.codeplex.com/" title="linq.js - LINQ for JavaScript Library - Home">linq.js</a>に書き直したのが上記のもの。C#のは載せませんけれど、ほとんど一緒です。</p>
<p>Distinctの部分だけはlinq.jsのほうがC#より書きやすい。匿名型を突っ込んでもハッシュなので、そのままセレクター渡して比較出来ちゃうので。あとWhereラッシュに対して$が<a href="http://sdc.sun.co.jp/java/series/groovy/200806.html">Groovyのit</a>のようなデフォルトのイテレータ引数として機能するので記述が楽なのは利点といえば利点。itのようなものはC#でも欲しいなあ、と思ってたりはする。</p>
<p>パフォーマンス？気にしたら負け、かな……。Chromeなら十分な速度で動くし。理想ではJavaScriptな人にもC#やLINQの良さが伝えられればな！なわけなのですが、現実は非常に厳しく誰もDLしてないよねですよね的ではあるけれど。うーん。</p>
<p>まあ、とりあえず、JavaScript的に特異なコードが書けるのでお遊びにでも使ってもらえると嬉しいです。</p>
</div>
<h1 data-pagefind-sort="date:2009-05-24" data-pagefind-meta="published:2009-05-24"><a href="https://neue.cc/2009/05/24_161.html">linq.js ver 1.3.0.0 - Unfold, Matches, etc...</a></h1>
<ul class="date"><li>2009-05-24</li></ul>
<div class="entry_body"><ul>
<li><a href="http://linqjs.codeplex.com/" title="linq.js - LINQ for JavaScript Library - Home">linq.js - LINQ for JavaScript Library - Home</a></li>
</ul>
<p>今回は本体も含めて大量更新です。生成子にUnfoldとMatchesを追加しました。Unfoldは応用範囲がとても広く(広すぎて逆に使い道が思いつかない)、Matchesは正規表現がより使いやすくなるので、実用度が非常に高いと思われます。そして、FromにStringを入れたときの動作を一文字毎に分解するよう変更。更に操作用メソッドにも、Insert, IndexOf, LastIndexOfを追加しました。あと、その他色々。</p>
<h2>Unfold</h2>
<p>UnfoldはAggregateの反対、といっても良くわからないのですが、引数と戻り値の型が同一の関数を無限に適用し続ける、という感じです。例えばE.Unfold(0, &quot;$+3&quot;)は、初期値が0で、適用する関数が+3。というわけで、0,3,6,9....と無限に3ずつ増幅していく値が取り出せます。これだけでは終了しないので、終了条件はTakeかTakeWhileで別に与えます。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">// フィボナッチ数列の無限リスト
var fib = E.Unfold({ a: 1, b: 1 }, &quot;{a:$.b, b:$.a + $.b}&quot;).Select(&quot;$.a&quot;);
// 10個分だけ画面に出力 - 1,1,2,3,5,8,13,21,34,55
fib.Take(10).WriteLine();

// abcdefを一文字ずつ削っていく- abcdef,bcdef,cdef,def,ef,f
E.Unfold(&quot;abcdef&quot;, &quot;$.substr(1)&quot;).TakeWhile(&quot;$.length&gt;0&quot;).WriteLine();
</code></pre>
<p>例はフィボナッチ数列で、これは<a href="http://d.hatena.ne.jp/NyaRuRu/20080127/p2" title="熟練した C# 使いは再帰を書かない？ - NyaRuRuの日記">熟練した C# 使いは再帰を書かない？ - NyaRuRuの日記</a>の丸コピです。タプルの片方を計算用の一時領域として使う、という感じでしょうか？</p>
<pre data-pagefind-ignore="all"><code class="language-csharp">static void Main(string[] args)
{
    // 16進の文字列をByte配列に変換する
    var str16 = &quot;FF-04-F2 B3 05 16F3&quot;;

    var regex = new Regex(@&quot;[abcdef\d]{2}&quot;, RegexOptions.IgnoreCase);

    // 全部マッチさせてから変換
    var byteArray1 = regex.Matches(str16)
        .Cast&lt;Match&gt;()
        .Select(m =&gt; Convert.ToByte(m.Value, 16));

    // Unfold使って一つずつ変換
    var byteArray2 = Unfold(regex.Match(str16), m =&gt; m.NextMatch())
        .TakeWhile(m =&gt; m.Success)
        .Select(m =&gt; Convert.ToByte(m.Value, 16));
}

static IEnumerable&lt;T&gt; Unfold&lt;T&gt;(T seed, Func&lt;T, T&gt; func)
{
    while (true)
    {
        yield return seed;
        seed = func(seed);
    }
}
</code></pre>
<p>UnfoldをC#で正規表現のマッチに使ってみた。あまり意味はない。これをJavaScriptでやると、マッチオブジェクトにNextMatch()がないので、lastIndexの変化したRegExpにexec()し続ける必要がある。というわけで、Timesを使えば同じことができます。E.Times(&quot;regex.exec(input)&quot;).TakeWhile(&quot;$ != null&quot;) です。String.match(オプションはglobal)を使って配列を取得したほうが楽なのですが、それだと文字列配列(みたいな何か)であって、個々のマッチオブジェクトが取れないので、個々のindex(一致した位置)やキャプチャが必要な場合はRegExp.execを使う、という使い分けかなー、と私は思っています。</p>
<h2>Matches</h2>
<p>そんなことを考えていたら、やっぱRegExp.execのglobalって使いづらいね、と思ったのでE.Matchesを追加しました。C#のRegex.Matchesと同じようにマッチオブジェクト全てを返します。配列で欲しい場合はToArray()を。そのまま処理を加えたい場合は、Linqのメソッド群全てが使えます。マッチのうち先頭だけが欲しいけど射影処理もしたい場合はMatches().Select().First()という手が使えます。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var input = &quot;abcdefgABzDefabgdg&quot;;
E.Matches(input, &quot;ab(.)d&quot;, &quot;i&quot;).ForEach(function(match)
{
    for (var prop in match)
    {
        document.write(prop + &quot; : &quot; + match[prop] + &quot;&lt;br /&gt;&quot;);
    }
    document.write(&quot;toString() : &quot; + match.toString() + &quot;&lt;br /&gt;&quot;);
    document.write(&quot;&lt;br /&gt;&quot;);
});

E.Matches(input, /ab(.)/i); // こうも書ける、gフラグはつけなくていい
E.Matches(input, &quot;ab(.)d&quot;); // 大文字小文字を区別するならflag無しで
</code></pre>
<p class="noindent">
	<img src="http://neue.cc/wp-content/uploads/image/ieregex.jpg">
</p>
<p>E.Matches(input, pattern, flags)で、patternは文字列でも正規表現オブジェクトでも、どちらでも可能。flagsは省略可、与える場合は仕様通り&quot;i&quot;, &quot;m&quot;, &quot;im&quot;が使えます。gフラグを明示的に与える必要はありません。与えても与えなくても関係なくglobalで検索します。</p>
<p>中に入るマッチオブジェクトなのですが、[0]にマッチした文字列全体、キャプチャがある場合は[1]以降にキャプチャした文字列が入ります。あとは.indexと.input。IEだと.lastIndexも取れてますが、IE以外のブラウザではlastIndexは使えません(undefinedでした)</p>
<h2>From(String)</h2>
<p>今までE.From(&quot;hoge&quot;).ToArray()とすると[0]=&quot;hoge&quot;になっていました。つまりE.Repeat(&quot;hoge&quot;,1)というわけです。これは、何というか、意味ないですよね。C#だと['h','o','g','e']というように、Charに分解します。というわけで、E.From(&quot;hoge&quot;).ToArray()の結果が[&quot;h&quot;,&quot;o&quot;,&quot;g&quot;,&quot;e&quot;]になるように動作を変更しました。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var input = &quot;こんにちは みなさん おげんき ですか？ わたしは げんき です。\
             この ぶんしょう は いぎりすの ケンブリッジ だいがく の けんきゅう の けっか\
             いかりゃく&quot;

var result = E.From(input.split(/[\s\t\n]/))
    .Select(function(s)
    {
        return (s.length &gt; 3)
            ? s.charAt(0)
              + E.From(s).Skip(1).Take(s.length - 2).Shuffle().ToString()
              + s.charAt(s.length - 1)
            : s;
    })
    .ToString(&quot; &quot;);

alert(result);
</code></pre>
<p>サンプルとして、流行から100歩遅れて<a href="http://www.itmedia.co.jp/news/articles/0905/08/news021.html">ケブンッリジ</a>変換をlinq.jsで。</p>
<p>真ん中の、「E.From(s).Skip(1).Take(s.length - 2).Shuffle().ToString()」という部分が「こんにちは」を「こんちには」に変換する部分です。E.From(s)で文字列を一文字ずつにバラしているわけです。Skip(1).Take(s.length-2)が、「最初と最後の文字を除く」です。実際の実行例は下のURLからどうぞ。</p>
<p><a href="http://neue.cc/kebunridge.htm" title="ケブンリッジ ジェネレータ">ケブンリッジ ジェネレータ</a></p>
<p>↑で動かしているものは、必ずシャッフルされるようにしたり、「、。！？」が末尾の時には別の処理をしていたりと、例に出しているコードとはちょっと違いますけれど。詳しくはソースを見てください。</p>
<h2>その他</h2>
<p>他に追加したメソッドはぶっちゃけ全然使い道ないのでササッと書き流します。まずInsertですが、これはConcatの場所自由版という感じにシーケンスを特定場所に挿入。IndexOf, LastIndexOfは位置の発見で見つからない場合は-1を返すというお馴染みな動作をします。他にlinq.tools.jsにHashSetを追加しました。これはC#のHashSetに似たようなもので、詳しくはリファレンス見てください。そして、Stopwatchに静的メソッドBenchを追加。これは、どうせStopwatch使うのはベンチマークの時だけでしょ？ということで。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var result = Linq.Tools.Stopwatch.Bench(1000, function()
{
    E.Range(1,100).Where(&quot;$%2==0&quot;).Select(&quot;$*$&quot;).Force();
});
document.write(result + 'ms')
</code></pre>
<p>第一引数に繰り返し回数、第二引数に実行する関数。わざわざDateの引き算をすることなく、気楽に計れるので、便利といえば便利。というか、この手のものは手間がかかるとついつい避けてしまうので、サクッと計れないとダメですものね。</p>
</div>
<h1 data-pagefind-sort="date:2009-05-18" data-pagefind-meta="published:2009-05-18"><a href="https://neue.cc/2009/05/18_160.html">Stopwatch</a></h1>
<ul class="date"><li>2009-05-18</li></ul>
<div class="entry_body"><ul>
<li><a href="http://linqjs.codeplex.com/" title="linq.js - LINQ for JavaScript Library - Home">linq.js - LINQ for JavaScript Library - Home</a></li>
<li><a href="http://neue.cc/linq.tools.reference.htm" title="linq.tools.js Reference">linq.tools.js Reference</a></li>
</ul>
<p>昨日の今日で変更というのも申し訳ないのですが、メソッド名を変えました。DateFormatはDateUtility.Format、DateParseはDateUtility.Parseになります。すみません。それだけじゃアレなので、その月の日数を返すDateUtility.DaysInMonthと、うるう年かどうかを判定するDateUtility.IsLeapYearを追加。それと、ストップウォッチクラス。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">// Stopwatchを生成・開始して……
var sw = Stopwatch.StartNew();
// 重たい処理をしたりして
E.Range(1, 10000).Select(&quot;$*$&quot;).Force();
// Elapsed()でms単位で表示
alert(sw.Elapsed() + &quot;ms&quot;);

/* その他のメソッド */
var sw = Stopwatch.Create(); // Stopwatchの生成(開始はしない)
sw.Start(); // 開始/再開
sw.Stop();  // タイマー停止
sw.Reset(); // タイマー停止＋経過時間リセット
sw.IsRunning(); // 動いてるか止まってるか
</code></pre>
<p>そろそろ変数名とかインデントは、郷に入り手は郷に従うべきですよねー。ていうか、単純にJavaScriptでC#的な書き方を持ちだすと普通に宜しくない。特に、コンストラクタとメソッドを区別するために大文字小文字にする必要性はとても感じる。と言いつつも、懲りづに続けていたりいなかったり。</p>
<p>それにしても本体を更新していないのにバージョン番号が増殖していくのはどうかと思う。しかも今回のStopwatchとDateTime系のはlinq全く関係ないという有様。</p>
</div>
<h1 data-pagefind-sort="date:2009-05-16" data-pagefind-meta="published:2009-05-16"><a href="https://neue.cc/2009/05/16_159.html">linq.tools.js</a></h1>
<ul class="date"><li>2009-05-16</li></ul>
<div class="entry_body"><ul>
<li><a href="http://linqjs.codeplex.com/" title="linq.js - LINQ for JavaScript Library - Home">linq.js - LINQ for JavaScript Library - Home</a></li>
<li><a href="http://neue.cc/linq.tools.reference.htm" title="linq.tools.js Reference">linq.tools.js Reference</a></li>
</ul>
<p>更新しました。今回は本体じゃなくて、ユーティリティスクリプトの追加が更新内容になります。少し便利なあると嬉しいちょっとした関数群をlinq.jsを使って。つまりそれってようするにただのサンプル……とは言ってはいけません。実際問題、sampleフォルダに入れちゃってますけどね！</p>
<p>中身は前回のテンプレート置換、配列を使って文字列を追加するStringBuilder、HTMLタグのエスケープをするHtmlEncode/Decode、クエリストリングをオブジェクトに変換するParseQueryStringとオブジェクトをクエリストリングに変換するToQueryString、そして書式を利用してDateを文字列に変換するDateFormatと文字列からDateに変換するDateParse。</p>
<p>詳しくは同梱のリファレンスを参照してください。それだけでもアレなので中身を幾つか。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">Linq.Tools.HttpUtility.ParseQueryString = function(query)
{
    return E.From(query.split('?'))
        .SelectMany(&quot;$.split('&amp;')&quot;, &quot;a,b=&gt;b.split('=')&quot;)
        .Where(&quot;$.length == 2&quot;)
        .ToObject(&quot;decodeURIComponent($[0])&quot;, &quot;decodeURIComponent($[1])&quot;);
}
</code></pre>
<p>と、こんな感じでLinqを活用しています。?でバラして&amp;でバラして=でバラしてオブジェクトに変換、と、QueryStringを見てまんま、思考のまんまに記述出来ます。便利便利。こういうのは個人的にもうforで書きたくないのですが、どうでしょう。</p>
<h2>DateFormat / DateParse</h2>
<p>Linq.Tools.DateFormat(date, format)はその名の通り、書式に基づいて日付を文字列に変換します。このぐらい標準で用意してあるといいのになあ……。formatは大体C#のに従う感じで、それなりに豊富。曜日も出せます。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">Linq.Tools.DateFormat = function(date, format)
{
	// 変数準備部省略
	
    var PadZero = function(str, width)
    {
        var count = width - str.length;
        return E.Repeat(&quot;0&quot;, count).ToString() + str;
    };

    var formatDict =
    {
        yyyy: year,
        yy: year.substring(2),
        y: year.substring(3),
        MM: PadZero(month, 2),
        M: month,
        dd: PadZero(day, 2),
        d: day,
		// 以下略
    };

    var regex = new RegExp(E.From(formatDict).Select(&quot;$.Key&quot;).ToString(&quot;|&quot;), &quot;g&quot;);
    return format.replace(regex, function(m) { return formatDict[m] });
}
</code></pre>
<p>変数部分がダラダラ長いので省略してます。0埋め関数が地味にLINQ。で、中身はいつものマンネリな手口です。置換用辞書作って、キー抜き出して正規表現作って、置換する。というだけです。実質二行。辞書の持ち方が若干富豪ですが、この程度なら全然気にならないでしょふ。あ、正規表現はこれだと順序が大事なので(yyyyの前にyyがマッチングされては困る)オブジェクトのキーを並べるやり方だと少し不安だけど、まあ、大丈夫でしょう！辞書の中身が動かないのだから、別に動的生成する必要は全くないどころか百害あって一理無しなのですが、それもまあ、無視黙殺。</p>
<pre data-pagefind-ignore="all"><code class="language-javascript">var day = Linq.Tools.DateParse(&quot;2009-11-12 131034&quot;, &quot;yyyy-MM-dd hhmmss&quot;);
var str = Linq.Tools.DateFormat(day, &quot;yyyy/MM/dd HH:mm:ss&quot;);
</code></pre>
<p>FormatがあったらParseもセットだよね、ということでParseも作りました。更に手抜きで、桁数が揃っていないと変換出来ません。だから使えるのはyyyy|MM|dd|HH|mm|ssだけです。hhはダメです。紛らわしくてすみません。あと、動作はyyyyとかのフォーマット文字しか見てないので、それ以外は何だっていいです。_でも空白でも、文字数だけ合わせれば動きます。とても適当。ソースも実にスッカスカ。</p>
</div>
<a href="https://neue.cc/26">Prev |</a>
<a href="https://neue.cc/28">| Next</a>
</div>
        <div id="side" data-pagefind-ignore="all">
<h3>Profile</h3>
<div class="side_body" align="center">
<b>Yoshifumi Kawai</b><br />
<br />
<a href="https://cysharp.co.jp/">Cysharp, Inc</a><br />
CEO/CTO<br />
<br />
Microsoft MVP for Developer Technologies(C#)<br />
April 2011<br />
|<br />
July 2024<br />
<br />
Twitter:<a href="https://twitter.com/neuecc/">@neuecc</a>
GitHub:<a href="https://github.com/neuecc/">neuecc</a>
</div>

<h3>Archive</h3>
<div class="side_body">
<ul>
<li><a href="https://neue.cc/2024/06/">2024-06</a>
<li><a href="https://neue.cc/2024/05/">2024-05</a>
<li><a href="https://neue.cc/2024/03/">2024-03</a>
<li><a href="https://neue.cc/2024/02/">2024-02</a>
<li><a href="https://neue.cc/2024/01/">2024-01</a>
<li><a href="https://neue.cc/2023/12/">2023-12</a>
<li><a href="https://neue.cc/2023/10/">2023-10</a>
<li><a href="https://neue.cc/2023/09/">2023-09</a>
<li><a href="https://neue.cc/2023/07/">2023-07</a>
<li><a href="https://neue.cc/2023/03/">2023-03</a>
<li><a href="https://neue.cc/2023/01/">2023-01</a>
<li><a href="https://neue.cc/2022/12/">2022-12</a>
<li><a href="https://neue.cc/2022/11/">2022-11</a>
<li><a href="https://neue.cc/2022/07/">2022-07</a>
<li><a href="https://neue.cc/2022/05/">2022-05</a>
<li><a href="https://neue.cc/2022/04/">2022-04</a>
<li><a href="https://neue.cc/2022/02/">2022-02</a>
<li><a href="https://neue.cc/2022/01/">2022-01</a>
<li><a href="https://neue.cc/2021/12/">2021-12</a>
<li><a href="https://neue.cc/2021/11/">2021-11</a>
<li><a href="https://neue.cc/2021/08/">2021-08</a>
<li><a href="https://neue.cc/2021/07/">2021-07</a>
<li><a href="https://neue.cc/2021/05/">2021-05</a>
<li><a href="https://neue.cc/2021/02/">2021-02</a>
<li><a href="https://neue.cc/2020/12/">2020-12</a>
<li><a href="https://neue.cc/2020/11/">2020-11</a>
<li><a href="https://neue.cc/2020/10/">2020-10</a>
<li><a href="https://neue.cc/2020/08/">2020-08</a>
<li><a href="https://neue.cc/2020/07/">2020-07</a>
<li><a href="https://neue.cc/2020/04/">2020-04</a>
<li><a href="https://neue.cc/2020/01/">2020-01</a>
<li><a href="https://neue.cc/2019/12/">2019-12</a>
<li><a href="https://neue.cc/2019/09/">2019-09</a>
<li><a href="https://neue.cc/2019/08/">2019-08</a>
<li><a href="https://neue.cc/2019/07/">2019-07</a>
<li><a href="https://neue.cc/2019/06/">2019-06</a>
<li><a href="https://neue.cc/2019/05/">2019-05</a>
<li><a href="https://neue.cc/2019/04/">2019-04</a>
<li><a href="https://neue.cc/2018/12/">2018-12</a>
<li><a href="https://neue.cc/2018/10/">2018-10</a>
<li><a href="https://neue.cc/2018/08/">2018-08</a>
<li><a href="https://neue.cc/2018/07/">2018-07</a>
<li><a href="https://neue.cc/2018/05/">2018-05</a>
<li><a href="https://neue.cc/2018/04/">2018-04</a>
<li><a href="https://neue.cc/2018/01/">2018-01</a>
<li><a href="https://neue.cc/2017/12/">2017-12</a>
<li><a href="https://neue.cc/2017/09/">2017-09</a>
<li><a href="https://neue.cc/2017/08/">2017-08</a>
<li><a href="https://neue.cc/2017/07/">2017-07</a>
<li><a href="https://neue.cc/2017/06/">2017-06</a>
<li><a href="https://neue.cc/2017/04/">2017-04</a>
<li><a href="https://neue.cc/2017/03/">2017-03</a>
<li><a href="https://neue.cc/2016/12/">2016-12</a>
<li><a href="https://neue.cc/2016/11/">2016-11</a>
<li><a href="https://neue.cc/2016/10/">2016-10</a>
<li><a href="https://neue.cc/2016/09/">2016-09</a>
<li><a href="https://neue.cc/2016/08/">2016-08</a>
<li><a href="https://neue.cc/2016/07/">2016-07</a>
<li><a href="https://neue.cc/2016/06/">2016-06</a>
<li><a href="https://neue.cc/2016/05/">2016-05</a>
<li><a href="https://neue.cc/2016/04/">2016-04</a>
<li><a href="https://neue.cc/2016/03/">2016-03</a>
<li><a href="https://neue.cc/2016/01/">2016-01</a>
<li><a href="https://neue.cc/2015/12/">2015-12</a>
<li><a href="https://neue.cc/2015/11/">2015-11</a>
<li><a href="https://neue.cc/2015/10/">2015-10</a>
<li><a href="https://neue.cc/2015/09/">2015-09</a>
<li><a href="https://neue.cc/2015/06/">2015-06</a>
<li><a href="https://neue.cc/2015/05/">2015-05</a>
<li><a href="https://neue.cc/2015/04/">2015-04</a>
<li><a href="https://neue.cc/2015/03/">2015-03</a>
<li><a href="https://neue.cc/2015/02/">2015-02</a>
<li><a href="https://neue.cc/2015/01/">2015-01</a>
<li><a href="https://neue.cc/2014/12/">2014-12</a>
<li><a href="https://neue.cc/2014/11/">2014-11</a>
<li><a href="https://neue.cc/2014/10/">2014-10</a>
<li><a href="https://neue.cc/2014/09/">2014-09</a>
<li><a href="https://neue.cc/2014/08/">2014-08</a>
<li><a href="https://neue.cc/2014/07/">2014-07</a>
<li><a href="https://neue.cc/2014/05/">2014-05</a>
<li><a href="https://neue.cc/2014/04/">2014-04</a>
<li><a href="https://neue.cc/2014/03/">2014-03</a>
<li><a href="https://neue.cc/2014/01/">2014-01</a>
<li><a href="https://neue.cc/2013/12/">2013-12</a>
<li><a href="https://neue.cc/2013/11/">2013-11</a>
<li><a href="https://neue.cc/2013/10/">2013-10</a>
<li><a href="https://neue.cc/2013/09/">2013-09</a>
<li><a href="https://neue.cc/2013/08/">2013-08</a>
<li><a href="https://neue.cc/2013/07/">2013-07</a>
<li><a href="https://neue.cc/2013/06/">2013-06</a>
<li><a href="https://neue.cc/2013/05/">2013-05</a>
<li><a href="https://neue.cc/2013/04/">2013-04</a>
<li><a href="https://neue.cc/2013/03/">2013-03</a>
<li><a href="https://neue.cc/2013/02/">2013-02</a>
<li><a href="https://neue.cc/2013/01/">2013-01</a>
<li><a href="https://neue.cc/2012/12/">2012-12</a>
<li><a href="https://neue.cc/2012/11/">2012-11</a>
<li><a href="https://neue.cc/2012/10/">2012-10</a>
<li><a href="https://neue.cc/2012/09/">2012-09</a>
<li><a href="https://neue.cc/2012/08/">2012-08</a>
<li><a href="https://neue.cc/2012/07/">2012-07</a>
<li><a href="https://neue.cc/2012/06/">2012-06</a>
<li><a href="https://neue.cc/2012/05/">2012-05</a>
<li><a href="https://neue.cc/2012/04/">2012-04</a>
<li><a href="https://neue.cc/2012/03/">2012-03</a>
<li><a href="https://neue.cc/2012/02/">2012-02</a>
<li><a href="https://neue.cc/2012/01/">2012-01</a>
<li><a href="https://neue.cc/2011/12/">2011-12</a>
<li><a href="https://neue.cc/2011/11/">2011-11</a>
<li><a href="https://neue.cc/2011/10/">2011-10</a>
<li><a href="https://neue.cc/2011/09/">2011-09</a>
<li><a href="https://neue.cc/2011/08/">2011-08</a>
<li><a href="https://neue.cc/2011/07/">2011-07</a>
<li><a href="https://neue.cc/2011/06/">2011-06</a>
<li><a href="https://neue.cc/2011/05/">2011-05</a>
<li><a href="https://neue.cc/2011/04/">2011-04</a>
<li><a href="https://neue.cc/2011/03/">2011-03</a>
<li><a href="https://neue.cc/2011/02/">2011-02</a>
<li><a href="https://neue.cc/2011/01/">2011-01</a>
<li><a href="https://neue.cc/2010/12/">2010-12</a>
<li><a href="https://neue.cc/2010/11/">2010-11</a>
<li><a href="https://neue.cc/2010/10/">2010-10</a>
<li><a href="https://neue.cc/2010/09/">2010-09</a>
<li><a href="https://neue.cc/2010/08/">2010-08</a>
<li><a href="https://neue.cc/2010/07/">2010-07</a>
<li><a href="https://neue.cc/2010/06/">2010-06</a>
<li><a href="https://neue.cc/2010/05/">2010-05</a>
<li><a href="https://neue.cc/2010/04/">2010-04</a>
<li><a href="https://neue.cc/2010/03/">2010-03</a>
<li><a href="https://neue.cc/2010/02/">2010-02</a>
<li><a href="https://neue.cc/2010/01/">2010-01</a>
<li><a href="https://neue.cc/2009/12/">2009-12</a>
<li><a href="https://neue.cc/2009/11/">2009-11</a>
<li><a href="https://neue.cc/2009/10/">2009-10</a>
<li><a href="https://neue.cc/2009/09/">2009-09</a>
<li><a href="https://neue.cc/2009/08/">2009-08</a>
<li><a href="https://neue.cc/2009/07/">2009-07</a>
<li><a href="https://neue.cc/2009/06/">2009-06</a>
<li><a href="https://neue.cc/2009/05/">2009-05</a>
<li><a href="https://neue.cc/2009/04/">2009-04</a>
<li><a href="https://neue.cc/2009/03/">2009-03</a>
<li><a href="https://neue.cc/2009/02/">2009-02</a>
<li><a href="https://neue.cc/2009/01/">2009-01</a>
</ul>
</div>
</div>
        <div id="footer" data-pagefind-ignore="all"><ul>
<li>Index: <a href="https://neue.cc">neue.cc</a><li>
<li>RSS feed: <a href="https://neue.cc/feed">neue.cc/feed</a><li>
<li>Powered by: <a href="https://github.com/neuecc/Blog2">https://github.com/neuecc/Blog2</a>
</ul></div>
    </div>
</body>
